A51 MACRO ASSEMBLER  QUESTION2                                                            08/15/2017 11:38:12 PAGE     1


MACRO ASSEMBLER A51 V8.2.5.0
OBJECT MODULE PLACED IN .\Objects\question2.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE question2.asm SET(SMALL) DEBUG PRINT(.\Listings\question2.lst) OBJECT(.
                      \Objects\question2.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;; Assembly program to read a nibble from the slider swithches and dislplay on the LEDs

0000                   2     org 0H

0000 020100            3     ljmp main

                       4     

0003                   5     delay:                          ;This routine takes input from 4FH location

0003 C0D0              6             push psw

0005 75D008            7             mov psw,#08H

                       8             using 1

0008 E54F              9             mov A,4FH               ;This is D

000A 75F00A           10             mov B,#10               ;Divides D by 2 and multiplies by 20 to convert into second
                             s

000D A4               11             mul AB                  ;Now A has the total number of times delay must be called

000E F8               12             mov r0,A                ;Total number of iterations over 50ms stored in A

000F                  13             delay1:

000F 7AC8             14                     mov R2,#200

0011                  15                     back1:

0011 79FF             16                             mov R1,#0FFH

0013 D9FE             17                             back: djnz R1, back

0015 DAFA             18                     djnz R2, back1

0017 D8F6             19             djnz r0, delay1

0019 D0D0             20             pop psw

001B 22               21     ret

                      22     

001C                  23     readNibble:

                      24             

001C                  25     loop:

001C 7590F0           26             mov P1,#0F0H    ;turn on all 4 LEDs (routine is ready to accept input from the user
                             )

001F 754F0A           27             mov 4FH,#10             ;wait for 5 sec during which user can give input through sw
                             itches

0022 1103             28             acall delay

0024 53900F           29             anl P1,#0FH             ;turn off all LEDS

0027 E590             30             mov A,P1                ;read the input from switches (nibble)

                      31             

0029                  32     value_changed:

0029 F54E             33             mov 4EH,A               ;show the read value on LEDs and store in 4EH

002B C4               34             swap A

002C F590             35             mov P1,A

002E 754F0A           36             mov 4FH,#10             ;Display for 5 sec till a new input is fed

0031 1103             37             acall delay

0033 53900F           38             anl P1,#0FH             ;clear LEDs (pin P1.7 - p1.4)

0036 E590             39             mov A,P1                ;read the input from switches

0038 B40FE1           40             cjne A,#0FH,loop        ;if  read value != 0Fh go to loop

                      41             

003B                  42     display_old:

003B E54E             43             mov A,4EH               ;otherwise display previously stored nibble from location 4
                             EH

003D C4               44             swap A

003E F590             45             mov P1,A

0040 754F0A           46             mov 4FH,#10             ;wait for 5 seconds

0043 1103             47             acall delay

0045 22               48             RET                     ;return from the subroutine.

                      49     

                      50     ;; =============================================

                      51     ;;                              Main Function

                      52     ;; =============================================

                      53     

A51 MACRO ASSEMBLER  QUESTION2                                                            08/15/2017 11:38:12 PAGE     2

0100                  54     org 100h

0100                  55     main:

0100 7581CF           56             mov SP,#0CFH    ;Initialising the pointer

0103 111C             57             acall readNibble

0105 80FE             58     here: sjmp here

                      59     end

A51 MACRO ASSEMBLER  QUESTION2                                                            08/15/2017 11:38:12 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

B. . . . . . . . .  D ADDR   00F0H   A   
BACK . . . . . . .  C ADDR   0013H   A   
BACK1. . . . . . .  C ADDR   0011H   A   
DELAY. . . . . . .  C ADDR   0003H   A   
DELAY1 . . . . . .  C ADDR   000FH   A   
DISPLAY_OLD. . . .  C ADDR   003BH   A   
HERE . . . . . . .  C ADDR   0105H   A   
LOOP . . . . . . .  C ADDR   001CH   A   
MAIN . . . . . . .  C ADDR   0100H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
PSW. . . . . . . .  D ADDR   00D0H   A   
READNIBBLE . . . .  C ADDR   001CH   A   
SP . . . . . . . .  D ADDR   0081H   A   
VALUE_CHANGED. . .  C ADDR   0029H   A   


REGISTER BANK(S) USED: 0 1 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
