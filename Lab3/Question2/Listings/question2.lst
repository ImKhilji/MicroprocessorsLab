A51 MACRO ASSEMBLER  QUESTION2                                                            08/16/2017 08:10:00 PAGE     1


MACRO ASSEMBLER A51 V8.2.5.0
OBJECT MODULE PLACED IN .\Objects\question2.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE question2.asm SET(SMALL) DEBUG PRINT(.\Listings\question2.lst) OBJECT(.
                      \Objects\question2.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;; Assembly program to read a nibble from the slider swithches and dislplay on the LEDs

0000                   2     org 0H

0000 020100            3     ljmp main

                       4     

0003                   5     delay:                          ;This routine takes input from 4FH location

0003 C0D0              6             push psw

0005 75D008            7             mov psw,#08H

                       8             using 1

0008 E54F              9             mov A,4FH               ;This is D

000A 75F00A           10             mov B,#10               ;Divides D by 2 and multiplies by 20 to convert into second
                             s

000D A4               11             mul AB                  ;Now A has the total number of times delay must be called

000E F8               12             mov r0,A                ;Total number of iterations over 50ms stored in A

000F                  13             delay1:

000F 7AC8             14                     mov R2,#200

0011                  15                     back1:

0011 79FF             16                             mov R1,#0FFH

0013 D9FE             17                             back: djnz R1, back

0015 DAFA             18                     djnz R2, back1

0017 D8F6             19             djnz r0, delay1

0019 D0D0             20             pop psw

001B 22               21     ret

                      22     

001C                  23     readNibble:

                      24             

001C                  25     loop:

001C D294             26             setb P1.4               ;turn on all 4 LEDs (routine is ready to accept input from 
                             the user)

001E D295             27             setb P1.5

0020 D296             28             setb P1.6

0022 D297             29             setb P1.7

0024 754F0A           30             mov 4FH,#10             ;wait for 5 sec during which user can give input through sw
                             itches

0027 1103             31             acall delay

0029 53900F           32             anl P1,#0FH             ;turn off all LEDS

002C E590             33             mov A,P1                ;read the input from switches (nibble)

                      34             

002E                  35     value_changed:

002E F54E             36             mov 4EH,A               ;show the read value on LEDs and store in 4EH

0030 C4               37             swap A

0031 F590             38             mov P1,A

0033 754F0A           39             mov 4FH,#10             ;Display for 5 sec till a new input is fed

0036 1103             40             acall delay

0038 53900F           41             anl P1,#0FH             ;clear LEDs (pin P1.7 - p1.4)

003B E590             42             mov A,P1                ;read the input from switches

003D B40FDC           43             cjne A,#0FH,loop        ;if  read value != 0Fh go to loop

                      44             

0040                  45     display_old:

0040 E54E             46             mov A,4EH               ;otherwise display previously stored nibble from location 4
                             EH

0042 C4               47             swap A

0043 F590             48             mov P1,A

0045 754F0A           49             mov 4FH,#10             ;wait for 5 seconds

0048 1103             50             acall delay

004A 22               51             RET                     ;return from the subroutine.

                      52     

                      53     

A51 MACRO ASSEMBLER  QUESTION2                                                            08/16/2017 08:10:00 PAGE     2

                      54     ;; =============================================

                      55     ;;                              Main Function

                      56     ;; =============================================

0100                  57     org 100h

0100                  58     main:

0100 7581CF           59             mov SP,#0CFH    ;Initialising the pointer

0103 111C             60             acall readNibble

0105 80FE             61     here: sjmp here

                      62     end

A51 MACRO ASSEMBLER  QUESTION2                                                            08/16/2017 08:10:00 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

B. . . . . . . . .  D ADDR   00F0H   A   
BACK . . . . . . .  C ADDR   0013H   A   
BACK1. . . . . . .  C ADDR   0011H   A   
DELAY. . . . . . .  C ADDR   0003H   A   
DELAY1 . . . . . .  C ADDR   000FH   A   
DISPLAY_OLD. . . .  C ADDR   0040H   A   
HERE . . . . . . .  C ADDR   0105H   A   
LOOP . . . . . . .  C ADDR   001CH   A   
MAIN . . . . . . .  C ADDR   0100H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
PSW. . . . . . . .  D ADDR   00D0H   A   
READNIBBLE . . . .  C ADDR   001CH   A   
SP . . . . . . . .  D ADDR   0081H   A   
VALUE_CHANGED. . .  C ADDR   002EH   A   


REGISTER BANK(S) USED: 0 1 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
